# Configuration file for Synapse.
# https://element-hq.github.io/synapse/latest/usage/configuration/config_documentation.html

# === Server Config
server_name: "matrix.cloud.buc.sh"
pid_file: /tmp/homeserver.pid
listeners:
  - port: 8008
    tls: false
    type: http
    x_forwarded: true
    resources:
    - names: [client]
      compress: false
database:
  name: sqlite3
  args:
    database: /db/homeserver.db
log_config: "/data/matrix.cloud.buc.sh.log.config"
media_store_path: /media/media_store
report_stats: true
serve_server_wellknown: true
web_client_location: https://chat.cloud.buc.sh/
public_baseurl: https://matrix.cloud.buc.sh
default_identity_server: https://matrix.org
oidc_providers:
- idp_id: dex
  idp_name: HomeLAB Dex
  issuer: "https://dex.buc.sh"
  client_id: "login"
  client_secret: "notaSecretDexisLocal"
  scopes: ["openid", "profile"]
  user_mapping_provider:
    config:
      localpart_template: "{{ user.name }}"
      display_name_template: "{{ user.name|capitalize }}"
enable_metrics: true
suppress_key_server_warning: true
trusted_key_servers: []
  # - server_name: "matrix.org"
url_preview_enabled: true
url_preview_ip_range_blacklist:
- 127.0.0.0/8
- 10.0.0.0/8
- 172.16.0.0/12
- 192.168.0.0/16
- 100.64.0.0/10
- 192.0.0.0/24
- 169.254.0.0/16
- 192.88.99.0/24
- 198.18.0.0/15
- 192.0.2.0/24
- 198.51.100.0/24
- 203.0.113.0/24
- 224.0.0.0/4
- ::1/128
- fe80::/10
- fc00::/7
- 2001:db8::/32
- ff00::/8
- fec0::/10
url_preview_ip_range_whitelist:
- 10.0.0.24/32   # Matrix Frigate URL proxy
- 10.0.0.9/32   # Matrix Frigate URL proxy
# url_preview_url_blacklist:
# - path: ^((?!notification).)*$
remote_media_download_per_second: 500M
remote_media_download_burst_count: 500M

# === Matrix Config
enable_registration: false
allow_public_rooms_without_auth: false
allow_public_rooms_over_federation: false
autocreate_auto_join_rooms: true
auto_join_rooms:
- '#bot:matrix.cloud.buc.sh'
- '#home:matrix.cloud.buc.sh'
- '#timerec:matrix.cloud.buc.sh'
auto_accept_invites:
  enabled: true
  only_from_local_users: true
retention:
  enabled: true
  default_policy:
    min_lifetime: 1d
    max_lifetime: 90d
#   allowed_lifetime_min: 1d
#   allowed_lifetime_max: 1y

# === Guest Access
allow_guest_access: false
# Only used for guest access: https://element-hq.github.io/synapse/latest/usage/configuration/config_documentation.html#macaroon_secret_key
# macaroon_secret_key: "xbPVY;xm7mUE2Poa0FTX5c_aB^m._M1i#x3c5~kN22X~QwtBq:"

# The Signing Key seems to be only used for Federatin and Cross-Server Communication. I think it can be auto-generated
signing_key_path: /tmp/matrix.cloud.buc.sh.signing.key

# Auto-Generate that Secret: https://element-hq.github.io/synapse/latest/usage/configuration/config_documentation.html#registration_shared_secret
registration_shared_secret_path: /tmp/registration_shared_secret

# Related to the User-Consent-Form: I think there isn't a downside to having it be public, since we don't need any form of consent-tracking?: https://element-hq.github.io/synapse/latest/usage/configuration/config_documentation.html#form_secret
form_secret: "bTVBqd_^3v7I&PCRM*#soj^Ct01ubi&c-vNo5R446*2hWE&yPC"

