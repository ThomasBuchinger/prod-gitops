---
apiVersion: v1
kind: Namespace
metadata:
  name: keycloak

---
apiVersion: k8s.keycloak.org/v2alpha1
kind: Keycloak
metadata:
  name: sso
spec:
  instances: 1
  bootstrapAdmin:
    user:
      secret: "keycloak-admin-creds"
  db:
    vendor: dev-file
    # url: jdbc:h2:file:/data/keycloak.db
  http:
    httpEnabled: true
    httpPort: 8080
    # httpsPort: 8443
  networkPolicy:
    enabled: false
  ingress:
    enabled: false
  #   tlsSecret: example-tls-secret
  hostname:
    hostname: https://sso.mtls.buc.sh
    admin: https://sso-admin.mtls.buc.sh/
    strict: false
    backchannelDynamic: true
  additionalOptions:
  - name: hostname-debug
    value: "true"
  proxy:
    headers: xforwarded # double check your reverse proxy sets and overwrites the X-Forwarded-* headers
  unsupported:
    podTemplate:
      spec:
        containers:
        - volumeMounts:
          - name: data
            mountPath: /opt/keycloak/data/h2
        volumes:
        - name: data
          emptyDir: {}

---
apiVersion: v1
kind: Secret
metadata:
  name: keycloak-admin-creds
stringData:
  username: admin
  password: changeme
